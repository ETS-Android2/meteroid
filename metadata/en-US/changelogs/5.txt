new in this version:
    less duplicate code
    better error messages
